---
import "../styles/global.css";
import { Image } from "astro:assets";
import logoProteck from "../assets/images/logo-proteck.png";
import logoProteckBlanco from "../assets/images/logo-proteck-blanco.png";

const {
  title = "Proteck - Servicios de Protecci√≥n Electr√≥nica",
  description = "Empresa l√≠der en servicios de protecci√≥n electr√≥nica, GPS, CCTV, alarmas y control de acceso en Costa Rica.",
  showHeader = true,
  showFooter = true,
  canonicalURL = Astro.url.href,
  image = "/og-image.jpg", // Aseg√∫rate de que esta imagen exista en public/
  type = "website",
  pageSchema = null // Para inyectar esquemas espec√≠ficos por p√°gina
} = Astro.props;

const siteName = "Proteck";

// Esquema de Organizaci√≥n Base
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Proteck",
  "alternateName": "Sistemas de Protecci√≥n Electr√≥nica Proteck",
  "url": "https://speproteck.com", // Cambiar por el dominio real si es diferente
  "logo": new URL("/images/logo-proteck.png", Astro.url).href,
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+506-2248-1071",
    "contactType": "customer service",
    "areaServed": "CR",
    "availableLanguage": "Spanish"
  },
  "sameAs": [
    "https://www.facebook.com/proteck", // Actualizar URLs reales si existen
    "https://www.instagram.com/proteck"
  ]
};
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <!-- SEO Principal -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url)} />
    <meta property="og:site_name" content={siteName} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.url)} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Preload LCP Image -->
    <link rel="preload" as="image" href="/hero-poster.webp" fetchpriority="high" />

    <!-- AEO: Structured Data (JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    {pageSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(pageSchema)} />
    )}
  </head>

  <body>
    {showHeader && (
    <!-- HEADER -->
    <header class="site-header">
      <div class="container header__inner">
        <a class="brand" href="/" aria-label="Ir al inicio">
          <Image 
            src={logoProteck} 
            alt="Proteck" 
            class="brand__logo" 
            width={160} 
            height={51} 
            loading="eager"
            fetchpriority="high"
          />
        </a>

        <!-- Hamburger Menu Button (Mobile) -->
        <button
          class="mobile-menu-btn"
          id="mobileMenuBtn"
          aria-label="Men√∫"
          aria-expanded="false"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>

        <!-- Navigation -->
        <nav class="nav" id="mainNav">
          <div class="nav__dropdown nav__dropdown--mega">
            <!-- PRODUCTOS (no navega, solo abre men√∫) -->
            <button class="nav__link nav__link--btn hover-lift" type="button">
              PRODUCTOS <span class="nav__caret">‚ñº</span>
            </button>

            <!-- Panel 1 -->
            <div class="dropdown mega">
              <div class="mega__col">
                <!-- Seguridad Electr√≥nica (solo abre subpanel) -->
                <div class="mega__item has-sub">
                  <span class="mega__link">
                    Seguridad Electr√≥nica <span class="mega__arrow">‚Ä∫</span>
                  </span>

                  <!-- Panel 2 -->
                  <div class="mega__sub">
                    <a class="mega__sublink" href="/video-vigilancia"
                      >Video Vigilancia</a
                    >
                    <a class="mega__sublink" href="/control-de-acceso"
                      >Control de Acceso</a
                    >
                    <a class="mega__sublink" href="/alarma-de-intrusion"
                      >Alarma de Intrusi√≥n</a
                    >
                  </div>
                </div>

                <!-- Telecomunicaciones (solo abre subpanel) -->
                <div class="mega__item has-sub">
                  <span class="mega__link">
                    Telecomunicaciones <span class="mega__arrow">‚Ä∫</span>
                  </span>

                  <div class="mega__sub">
                    <a class="mega__sublink" href="/cableado-estructurado"
                      >Cableado Estructurado</a
                    >
                    <a class="mega__sublink" href="/canalizaciones"
                      >Canalizaciones</a
                    >
                    <a class="mega__sublink" href="/sistema-audio-megafonia"
                      >Sistema de Audio y Megafon√≠a</a
                    >
                    <a class="mega__sublink" href="/redes-inalambricas"
                      >Redes Inal√°mbricas</a
                    >
                  </div>
                </div>

                <!-- Detecci√≥n y supresi√≥n de incendio (solo abre subpanel) -->
                <div class="mega__item has-sub">
                  <span class="mega__link">
                    Detecci√≥n y supresi√≥n de incendio <span class="mega__arrow"
                      >‚Ä∫</span
                    >
                  </span>

                  <div class="mega__sub">
                    <a class="mega__sublink" href="/alarma"
                      >Alarma contra Incendio</a
                    >
                    <!-- si luego hac√©s supresi√≥n como otra p√°gina, la agreg√°s aqu√≠ -->
                    <!-- <a class="mega__sublink" href="/supresion-incendio">Supresi√≥n de Incendio</a> -->
                  </div>
                </div>

                <!-- GPS (s√≠ es p√°gina) -->
                <a class="mega__link mega__link--single" href="/gps">GPS</a>
              </div>
            </div>
          </div>

          <a class="nav__link hover-lift" href="/gps">GPS</a>
          <a class="nav__link hover-lift" href="/soluciones">SOLUCIONES</a>
          <a class="nav__link hover-lift" href="/quienes-somos">QUI√âNES SOMOS</a>
          <a class="btn btn--contact" href="/contactos">Contactar</a>
        </nav>
      </div>
    </header>
    )}

    {showHeader && (
    <script is:inline>
      // Set js-enabled class early
      document.documentElement.classList.add('js-enabled');
      
      document.addEventListener("DOMContentLoaded", () => {
        // Scroll-triggered animations
        const observerOptions = {
          root: null,
          rootMargin: '0px',
          threshold: 0.1
        };

        const animationObserver = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              // Unobserve once animation is triggered
              animationObserver.unobserve(entry.target);
            }
          });
        }, observerOptions);

        // Select and observe all elements with data-animate
        const animatedElements = document.querySelectorAll('[data-animate]');
        animatedElements.forEach(el => animationObserver.observe(el));

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById("mobileMenuBtn");
        const mainNav = document.getElementById("mainNav");

        if (mobileMenuBtn && mainNav) {
          mobileMenuBtn.addEventListener("click", () => {
            mobileMenuBtn.classList.toggle("active");
            mainNav.classList.toggle("active");

            // Update aria-expanded
            const isExpanded = mainNav.classList.contains("active");
            mobileMenuBtn.setAttribute("aria-expanded", isExpanded.toString());
          });

          // Close menu when clicking on a link
          const navLinks = mainNav.querySelectorAll("a");
          navLinks.forEach((link) => {
            link.addEventListener("click", () => {
              mobileMenuBtn.classList.remove("active");
              mainNav.classList.remove("active");
              mobileMenuBtn.setAttribute("aria-expanded", "false");
            });
          });
        }

        // Mobile mega menu toggle (for touch devices)
        const megaMenuBtn = document.querySelector(".nav__link--btn");
        const megaDropdown = document.querySelector(".dropdown.mega");

        console.log("Mega menu button:", megaMenuBtn);
        console.log("Mega dropdown:", megaDropdown);

        if (megaMenuBtn && megaDropdown) {
          megaMenuBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();

            console.log("Productos button clicked!");

            // Toggle the mega dropdown using class
            megaDropdown.classList.toggle("active");
            console.log(
              "Dropdown active:",
              megaDropdown.classList.contains("active"),
            );
          });

          // Handle mega menu items (parent categories)
          const megaItems = document.querySelectorAll(".mega__item.has-sub");
          console.log("Mega items found:", megaItems.length);

          megaItems.forEach((item) => {
            const megaLink = item.querySelector(".mega__link");
            const megaSub = item.querySelector(".mega__sub");

            if (megaLink && megaSub) {
              megaLink.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();

                console.log("Category clicked!");

                // Close other open submenus
                megaItems.forEach((otherItem) => {
                  if (otherItem !== item) {
                    const otherSub = otherItem.querySelector(".mega__sub");
                    if (otherSub) {
                      otherSub.classList.remove("active");
                    }
                  }
                });

                // Toggle this submenu using class
                megaSub.classList.toggle("active");
                console.log(
                  "Submenu active:",
                  megaSub.classList.contains("active"),
                );
              });
            }
          });

          // Close mega menu when clicking outside
          document.addEventListener("click", (e) => {
            const target = e.target;
            if (target && typeof target.closest === "function") {
              if (!target.closest(".nav__dropdown--mega")) {
                megaDropdown.classList.remove("active");
                // Close all submenus
                megaItems.forEach((item) => {
                  const megaSub = item.querySelector(".mega__sub");
                  if (megaSub) {
                    megaSub.classList.remove("active");
                  }
                });
              }
            }
          });
        } else {
          console.error("Mega menu elements not found!");
        }
      });
    </script>
    )}

    <main>
      <slot />
    </main>

    {showFooter && (
    <!-- FOOTER -->
    <footer class="site-footer">
      <div class="container footer-grid">
        <div class="footer-brand">
          <Image 
            src={logoProteckBlanco} 
            alt="Proteck" 
            class="footer-logo" 
            width={160} 
            height={51} 
            loading="lazy"
          />

          <div class="footer-social">
            <a
              class="social-btn"
              href="#"
              aria-label="Facebook"
              title="Facebook"
            >
              <!-- Facebook SVG -->
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M22 12a10 10 0 1 0-11.5 9.9v-7H8v-3h2.5V9.8C10.5 7.3 12 6 14.3 6c1.1 0 2.2.2 2.2.2v2.4h-1.2c-1.2 0-1.6.8-1.6 1.5V12H16l-.4 3h-2v7A10 10 0 0 0 22 12Z"
                ></path>
              </svg>
            </a>

            <a
              class="social-btn"
              href="#"
              aria-label="Instagram"
              title="Instagram"
            >
              <!-- Instagram SVG -->
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9ZM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6Zm6.2-2.6a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"
                ></path>
              </svg>
            </a>
          </div>
        </div>

        <div class="footer-col">
          <h3>Enlaces R√°pidos</h3>
          <ul class="footer-list">
            <li><span class="chev">‚Ä∫</span><a href="/">Inicio</a></li>
            <li>
              <span class="chev">‚Ä∫</span><a href="/quienes-somos"
                >Acerca de Nosotros</a
              >
            </li>
            <li><span class="chev">‚Ä∫</span><a href="/gps">GPS</a></li>
            <li><span class="chev">‚Ä∫</span><a href="/cctv">CCTV</a></li>
            <li>
              <span class="chev">‚Ä∫</span><a href="/contactos">Contacto</a>
            </li>
          </ul>
        </div>

        <div class="footer-col">
          <h3>Servicios</h3>
          <ul class="footer-list">
            <li><span class="ico">üìç</span><span>Rastreo GPS</span></li>
            <li><span class="ico">üïí</span><span>Monitoreo 24/7</span></li>
            <li>
              <span class="ico">üîî</span><span>Alertas en Tiempo Real</span>
            </li>
            <li><span class="ico">üöö</span><span>Gesti√≥n de Flotas</span></li>
            <li><span class="ico">üõ†Ô∏è</span><span>Soporte T√©cnico</span></li>
          </ul>
        </div>

        <div class="footer-col">
          <h3>Contacto</h3>
          <ul class="footer-list">
            <li><span class="ico">üìû</span><span>+506 2248-1071</span></li>
            <li>
              <span class="ico">‚úâÔ∏è</span><a href="mailto:info@proteck.com"
                >info@proteck.com</a
              >
            </li>
            <li>
              <span class="ico">üïò</span><span>Lun - Vie: 9:00 - 18:00</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="container footer-bottom__inner">
          (c) 2025 SPE Proteck - Todos los derechos reservados
        </div>
      </div>
    </footer>
    )}
  </body>
</html>
